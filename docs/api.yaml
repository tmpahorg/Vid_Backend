swagger: '2.0'
host: 127.0.0.1:3344
basePath: /
tags:
- name: Ping
  description: Ping
- name: Authorization
  description: Auth-Controller
- name: User
  description: User-Controller
- name: Subscribe
  description: Sub-Controller
- name: Video
  description: Video-Controller
- name: Raw
  description: Raw-Controller
- name: Policy
  description: Policy-Controller
- name: Search
  description: Search-Controller
- name: Administration
  description: '*-Controller'
info:
  title: vid backend
  description: Backend of repo https://github.com/vidorg/vid_vue
  version: '1.1'
  termsOfService: https://github.com/vidorg/vid_backend/issues
  license:
    name: MIT
    url: https://github.com/vidorg/vid_backend/blob/master/LICENSE
  contact:
    name: vidorg
    url: https://github.com/vidorg
securityDefinitions:
  Jwt:
    type: apiKey
    name: Authorization
    in: header
paths:
  /v1/auth/login:
    post:
      operationId: v1-auth-login-post
      summary: 登录
      tags:
      - Authorization
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: param
        in: body
        required: true
        description: 请求参数
        schema:
          $ref: '#/definitions/LoginParam'
      security: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result<LoginDto>'
  /v1/auth/register:
    post:
      operationId: v1-auth-register-post
      summary: 注册
      tags:
      - Authorization
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: param
        in: body
        required: true
        description: 请求参数
        schema:
          $ref: '#/definitions/RegisterParam'
      security: []
      responses:
        '201':
          schema:
            $ref: '#/definitions/Result<UserDto>'
  /v1/auth:
    get:
      operationId: v1-auth-get
      summary: 当前登录用户
      tags:
      - Authorization
      consumes:
      - application/json
      produces:
      - application/json
      security:
      - Jwt: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result<UserDto>'
  /v1/auth/logout:
    post:
      operationId: v1-auth-logout-post
      summary: 注销
      tags:
      - Authorization
      consumes:
      - application/json
      produces:
      - application/json
      security:
      - Jwt: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result'
  /v1/auth/password:
    put:
      operationId: v1-auth-password-put
      summary: 修改密码
      tags:
      - Authorization
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: param
        in: body
        required: true
        description: 请求参数
        schema:
          $ref: '#/definitions/PassParam'
      security:
      - Jwt: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result'
  /v1/policy/role/{uid}:
    put:
      operationId: v1-policy-role-uid-put
      summary: 修改用户权限
      tags:
      - Policy
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: uid
        in: path
        type: integer
        required: true
        description: 用户id
      - name: param
        in: body
        required: true
        description: 请求参数
        schema:
          $ref: '#/definitions/RoleParam'
      security:
      - Jwt: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result'
  /v1/policy:
    get:
      operationId: v1-policy-get
      summary: 查询所有策略
      tags:
      - Policy
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: page
        in: query
        type: integer
        required: false
        description: 当前页
        default: 1
      - name: limit
        in: query
        type: integer
        required: false
        description: 页大小
        default: 10
      security:
      - Jwt: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result<Page<PolicyDto>>'
    post:
      operationId: v1-policy-post
      summary: 插入策略
      tags:
      - Policy
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: param
        in: body
        required: true
        description: 请求参数
        schema:
          $ref: '#/definitions/PolicyParam'
      security:
      - Jwt: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result'
    delete:
      operationId: v1-policy-delete
      summary: 删除策略
      tags:
      - Policy
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: param
        in: body
        required: true
        description: 请求参数
        schema:
          $ref: '#/definitions/PolicyParam'
      security:
      - Jwt: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result'
  /v1/raw/image:
    post:
      operationId: v1-raw-image-post
      summary: 上传图片
      tags:
      - Raw
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: image
        in: formData
        type: file
        required: true
        description: 上传的图片，大小限制在2M，允许后缀名为 {.jpg, .jpeg, .png, .bmp, .gif}
      security:
      - Jwt: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result<ImageDto>'
  /v1/raw/image/{filename}:
    get:
      operationId: v1-raw-image-filename-get
      summary: 获取图片
      tags:
      - Raw
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: filename
        in: path
        type: string
        required: true
        description: 图片文件名
      security: []
      responses:
        '200':
          headers:
            Content-Type:
              type: string
              description: image/jpeg
  /v1/search/user:
    get:
      operationId: v1-search-user-get
      summary: 搜索用户
      tags:
      - Search
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: page
        in: query
        type: integer
        required: false
        description: 当前页
        default: 1
      - name: limit
        in: query
        type: integer
        required: false
        description: 页大小
        default: 10
      - name: key
        in: query
        type: string
        required: true
        description: 搜索关键词
      security: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result<Page<UserDto>>'
  /v1/search/video:
    get:
      operationId: v1-search-video-get
      summary: 搜索视频
      tags:
      - Search
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: page
        in: query
        type: integer
        required: false
        description: 当前页
        default: 1
      - name: limit
        in: query
        type: integer
        required: false
        description: 页大小
        default: 10
      - name: key
        in: query
        type: string
        required: true
        description: 搜索关键词
      security: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result<Page<VideoDto>>'
  /v1/user/{uid}/subscriber:
    get:
      operationId: v1-user-uid-subscriber-get
      summary: 查询用户粉丝
      tags:
      - Subscribe
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: page
        in: query
        type: integer
        required: false
        description: 当前页
        default: 1
      - name: limit
        in: query
        type: integer
        required: false
        description: 页大小
        default: 10
      - name: order
        in: query
        type: string
        required: false
        description: 排序字符串
      - name: uid
        in: path
        type: integer
        required: true
        description: 用户id
      security: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result<Page<UserDto>>'
  /v1/user/{uid}/subscribing:
    get:
      operationId: v1-user-uid-subscribing-get
      summary: 查询用户关注
      tags:
      - Subscribe
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: page
        in: query
        type: integer
        required: false
        description: 当前页
        default: 1
      - name: limit
        in: query
        type: integer
        required: false
        description: 页大小
        default: 10
      - name: order
        in: query
        type: string
        required: false
        description: 排序字符串
      - name: uid
        in: path
        type: integer
        required: true
        description: 用户id
      security: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result<Page<UserDto>>'
  /v1/user/subscribing:
    put:
      operationId: v1-user-subscribing-put
      summary: 关注用户
      tags:
      - Subscribe
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: param
        in: body
        required: true
        description: 请求参数
        schema:
          $ref: '#/definitions/SubParam'
      security:
      - Jwt: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result'
    delete:
      operationId: v1-user-subscribing-delete
      summary: 取消关注用户
      tags:
      - Subscribe
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: param
        in: body
        required: true
        description: 请求参数
        schema:
          $ref: '#/definitions/SubParam'
      security:
      - Jwt: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result'
  /v1/user:
    get:
      operationId: v1-user-get
      summary: 查询所有用户
      description: 管理员权限，此处可见用户手机号码
      tags:
      - User
      - Administration
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: page
        in: query
        type: integer
        required: false
        description: 当前页
        default: 1
      - name: limit
        in: query
        type: integer
        required: false
        description: 页大小
        default: 10
      - name: order
        in: query
        type: string
        required: false
        description: 排序字符串
      security:
      - Jwt: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result<Page<UserDto>>'
    put:
      operationId: v1-user-put
      summary: 更新用户
      tags:
      - User
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: param
        in: body
        required: true
        description: 请求参数
        schema:
          $ref: '#/definitions/UserParam'
      security:
      - Jwt: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result<UserDto>'
    delete:
      operationId: v1-user-delete
      summary: 删除用户
      tags:
      - User
      consumes:
      - application/json
      produces:
      - application/json
      security:
      - Jwt: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result'
  /v1/user/{uid}:
    get:
      operationId: v1-user-uid-get
      summary: 查询用户
      description: 此处用户本人可见手机号码，管理员不受限制
      tags:
      - User
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: uid
        in: path
        type: integer
        required: true
        description: 用户id
      security: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result<UserExtraDto>'
  /v1/user/admin/{uid}:
    put:
      operationId: v1-user-admin-uid-put
      summary: 更新用户
      description: 管理员权限
      tags:
      - User
      - Administration
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: uid
        in: path
        type: integer
        required: true
        description: 用户id
      - name: param
        in: body
        required: true
        description: 请求参数
        schema:
          $ref: '#/definitions/UserParam'
      security:
      - Jwt: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result<UserDto>'
    delete:
      operationId: v1-user-admin-uid-delete
      summary: 删除用户
      description: 管理员权限
      tags:
      - User
      - Administration
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: uid
        in: path
        type: integer
        required: true
        description: 用户id
      security:
      - Jwt: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result'
  /v1/video:
    get:
      operationId: v1-video-get
      summary: 查询所有视频
      description: 管理员权限
      tags:
      - Video
      - Administration
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: page
        in: query
        type: integer
        required: false
        description: 当前页
        default: 1
      - name: limit
        in: query
        type: integer
        required: false
        description: 页大小
        default: 10
      - name: order
        in: query
        type: string
        required: false
        description: 排序字符串
      security:
      - Jwt: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result<Page<VideoDto>>'
    post:
      operationId: v1-video-post
      summary: 新建视频
      tags:
      - Video
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: param
        in: body
        required: true
        description: 请求参数
        schema:
          $ref: '#/definitions/VideoParam'
      security:
      - Jwt: []
      responses:
        '201':
          schema:
            $ref: '#/definitions/Result<VideoDto>'
  /v1/user/{uid}/video:
    get:
      operationId: v1-user-uid-video-get
      summary: 查询用户发布的所有视频
      tags:
      - Video
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: page
        in: query
        type: integer
        required: false
        description: 当前页
        default: 1
      - name: limit
        in: query
        type: integer
        required: false
        description: 页大小
        default: 10
      - name: order
        in: query
        type: string
        required: false
        description: 排序字符串
      - name: uid
        in: path
        type: integer
        required: true
        description: 用户id
      security: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result<Page<VideoDto>>'
  /v1/video/{vid}:
    get:
      operationId: v1-video-vid-get
      summary: 查询视频
      tags:
      - Video
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: vid
        in: path
        type: integer
        required: true
        description: 视频id
      security: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result<VideoDto>'
    post:
      operationId: v1-video-vid-post
      summary: 更新视频
      description: 管理员或者作者本人权限
      tags:
      - Video
      - Administration
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: vid
        in: path
        type: string
        required: true
        description: 视频id
      - name: param
        in: body
        required: true
        description: 请求参数
        schema:
          $ref: '#/definitions/VideoParam'
      security:
      - Jwt: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result<VideoDto>'
    delete:
      operationId: v1-video-vid-delete
      summary: 删除视频
      description: 管理员或者作者本人权限
      tags:
      - Video
      - Administration
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: vid
        in: path
        type: string
        required: true
        description: 视频id
      security:
      - Jwt: []
      responses:
        '200':
          schema:
            $ref: '#/definitions/Result'
  /ping:
    get:
      operationId: ping-get
      summary: Ping
      tags:
      - Ping
      consumes:
      - application/json
      produces:
      - application/json
      security: []
      responses:
        '200':
          examples:
            application/json: |-
              {
                "ping": "pong"
              }
definitions:
  _PolicyDto:
    title: _PolicyDto
    description: policy response
    type: object
    required:
    - role
    - path
    - method
    properties:
      role:
        description: 策略角色 (sub)
        type: string
      path:
        description: 策略路径 (obj)
        type: string
      method:
        description: 策略方法 (act)
        type: string
  _LoginDto:
    title: _LoginDto
    description: 登录信息
    type: object
    required:
    - user
    - token
    - expire
    properties:
      user:
        description: 用户信息
        type: object
        $ref: '#/definitions/_UserDto'
      token:
        description: 登录令牌
        type: string
      expire:
        description: 登录有效期，单位为秒
        type: integer
  _UserDto:
    title: _UserDto
    description: 用户信息
    type: object
    required:
    - uid
    - username
    - sex
    - profile
    - avatar_url
    - birthday
    - role
    - phone_number
    - register_time
    properties:
      uid:
        description: 用户id
        type: integer
      username:
        description: 用户名
        type: string
      sex:
        description: 用户性别
        type: string
        enum:
        - male
        - female
        - unknown
      profile:
        description: 用户简介
        type: string
      avatar_url:
        description: 用户头像
        type: string
      birthday:
        description: 用户生日
        type: string
        format: date
      role:
        description: 用户角色
        type: string
      phone_number:
        description: 用户手机号码，部分接口可见
        type: string
      register_time:
        description: 用户注册时间
        type: string
        format: datetime
  _UserAndExtraDto:
    title: _UserAndExtraDto
    description: 用户与数量信息
    type: object
    required:
    - user
    - extra
    properties:
      user:
        description: 用户信息
        type: object
        $ref: '#/definitions/_UserDto'
      extra:
        description: 用户额外信息
        type: object
        $ref: '#/definitions/_UserExtraDto'
  _UserExtraDto:
    title: _UserExtraDto
    description: 用户额外信息
    type: object
    required:
    - subscribing_cnt
    - subscriber_cnt
    - video_cnt
    properties:
      subscribing_cnt:
        description: 用户关注数量
        type: integer
      subscriber_cnt:
        description: 用户粉丝数量
        type: integer
      video_cnt:
        description: 用户视频数量
        type: integer
  _VideoDto:
    title: _VideoDto
    description: 视频信息
    type: object
    required:
    - vid
    - title
    - description
    - video_url
    - cover_url
    - upload_time
    - update_time
    - author
    properties:
      vid:
        description: 视频id
        type: integer
      title:
        description: 视频标题
        type: string
      description:
        description: 标题简介
        type: string
      video_url:
        description: 视频资源链接
        type: string
      cover_url:
        description: 视频封面连接
        type: string
      upload_time:
        description: 视频上传时间
        type: string
        format: datetime
      update_time:
        description: 视频修改时间
        type: string
        format: datetime
      author:
        description: 视频作者，用户id为-1表示用户已删除
        type: object
        $ref: '#/definitions/_UserDto'
  Result:
    title: Result
    description: 返回统一响应结果
    type: object
    required:
    - code
    - message
    properties:
      code:
        description: 响应码
        type: integer
      message:
        description: 状态信息
        type: string
  _ImageDto:
    title: _ImageDto
    description: 上传图片信息
    type: object
    required:
    - url
    - size
    properties:
      url:
        description: 图片链接
        type: string
      size:
        description: 图片大小，单位为字节
        type: integer
  Result<UserDto>:
    title: Result<UserDto>
    description: 返回用户信息
    type: object
    required:
    - code
    - message
    - data
    properties:
      code:
        description: 返回响应码
        type: integer
      message:
        description: 返回信息
        type: string
      data:
        description: 返回数据
        type: object
        $ref: '#/definitions/_UserDto'
  Result<LoginDto>:
    title: Result<LoginDto>
    description: 登录信息
    type: object
    required:
    - code
    - message
    - data
    properties:
      code:
        description: 返回响应码
        type: integer
      message:
        description: 返回信息
        type: string
      data:
        description: 返回数据
        type: object
        $ref: '#/definitions/_LoginDto'
  Result<UserExtraDto>:
    title: Result<UserExtraDto>
    description: 返回用户与数量信息
    type: object
    required:
    - code
    - message
    - data
    properties:
      code:
        description: 返回响应码
        type: integer
      message:
        description: 返回信息
        type: string
      data:
        description: 返回数据
        type: object
        $ref: '#/definitions/_UserAndExtraDto'
  Result<VideoDto>:
    title: Result<VideoDto>
    description: 返回视频信息
    type: object
    required:
    - code
    - message
    - data
    properties:
      code:
        description: 返回响应码
        type: integer
      message:
        description: 返回信息
        type: string
      data:
        description: 返回数据
        type: object
        $ref: '#/definitions/_VideoDto'
  Result<ImageDto>:
    title: Result<ImageDto>
    description: 返回上传图片信息
    type: object
    required:
    - code
    - message
    - data
    properties:
      code:
        description: 返回响应码
        type: integer
      message:
        description: 返回信息
        type: string
      data:
        description: 返回数据
        type: object
        $ref: '#/definitions/_ImageDto'
  Page<UserDto>:
    title: Page<UserDto>
    description: 用户分页信息
    type: object
    required:
    - total
    - page
    - limit
    - data
    properties:
      total:
        description: 数据总量
        type: integer
      page:
        description: 当前页
        type: int
      limit:
        description: 页大小
        type: int
      data:
        description: 返回数据
        type: array
        items:
          $ref: '#/definitions/_UserDto'
  Page<VideoDto>:
    title: Page<VideoDto>
    description: 视频分页信息
    type: object
    required:
    - total
    - page
    - limit
    - data
    properties:
      total:
        description: 数据总量
        type: integer
      page:
        description: 当前页
        type: int
      limit:
        description: 页大小
        type: int
      data:
        description: 返回数据
        type: array
        items:
          $ref: '#/definitions/_VideoDto'
  Page<PolicyDto>:
    title: Page<PolicyDto>
    description: policy page
    type: object
    required:
    - total
    - page
    - limit
    - data
    properties:
      total:
        description: 数据总量
        type: integer
      page:
        description: 当前页
        type: integer
      limit:
        description: 页大小
        type: integer
      data:
        description: 返回数据
        type: array
        items:
          $ref: '#/definitions/_PolicyDto'
  Result<Page<UserDto>>:
    title: Result<Page<UserDto>>
    description: 返回用户分页信息
    type: object
    required:
    - code
    - message
    - data
    properties:
      code:
        description: 返回响应码
        type: integer
      message:
        description: 返回信息
        type: string
      data:
        description: 返回数据
        type: object
        $ref: '#/definitions/Page<UserDto>'
  Result<Page<VideoDto>>:
    title: Result<Page<VideoDto>>
    description: 返回视频分页信息
    type: object
    required:
    - code
    - message
    - data
    properties:
      code:
        description: 返回响应码
        type: integer
      message:
        description: 返回信息
        type: string
      data:
        description: 返回数据
        type: object
        $ref: '#/definitions/Page<VideoDto>'
  Result<Page<PolicyDto>>:
    title: Result<Page<PolicyDto>>
    description: policy page response
    type: object
    required:
    - code
    - message
    - data
    properties:
      code:
        description: 返回响应码
        type: integer
      message:
        description: 返回信息
        type: string
      data:
        description: 返回数据
        type: object
        $ref: '#/definitions/Page<PolicyDto>'
  LoginParam:
    title: LoginParam
    description: 登录请求参数
    type: object
    required:
    - username
    - password
    properties:
      username:
        description: 用户名
        type: string
      password:
        description: 密码
        type: string
      expire:
        description: 登录有效期，默认为七天
        type: integer
  RegisterParam:
    title: RegisterParam
    description: 注册请求参数
    type: object
    required:
    - username
    - password
    properties:
      username:
        description: 用户名，长度在 [5, 30] 之间
        type: string
      password:
        description: 密码，长度在 [8, 30] 之间
        type: string
  PassParam:
    title: PassParam
    description: 修改密码请求参数
    type: object
    required:
    - password
    properties:
      password:
        description: 密码，长度在 [8, 30] 之间
        type: string
  PolicyParam:
    title: PolicyParam
    description: 权限策略参数
    type: object
    required:
    - role
    - path
    - method
    properties:
      role:
        description: policy role
        type: string
      path:
        description: policy path
        type: string
      method:
        description: policy method
        type: string
  RoleParam:
    title: RoleParam
    description: 修改权限参数
    type: object
    required:
    - role
    properties:
      role:
        description: policy role
        type: string
  SubParam:
    title: SubParam
    description: 关注请求参数
    type: object
    required:
    - to
    properties:
      to:
        description: 用户id
        type: integer
  UserParam:
    title: UserParam
    description: 用户请求参数
    type: object
    required:
    - username
    - profile
    - sex
    - birthday
    - phone_number
    - avatar_url
    properties:
      username:
        description: 用户名，长度在 [5, 30] 之间
        type: string
      profile:
        description: 用户简介，长度在 [0, 255] 之间
        type: string
        allowEmptyValue: true
      sex:
        description: 用户性别
        type: string
        enum:
        - male
        - female
        - unknown
      birthday:
        description: 用户生日
        type: string
        format: date
      phone_number:
        description: 用户手机号码，长度为 11，仅限中国大陆手机号码
        type: string
      avatar_url:
        description: 用户头像链接
        type: string
  VideoParam:
    title: VideoParam
    description: 视频请求参数
    type: object
    required:
    - title
    - description
    - cover_url
    - video_url
    properties:
      title:
        description: 视频标题，长度在 [1, 100] 之间
        type: string
      description:
        description: 视频简介，长度在 [0, 255] 之间
        type: string
        allowEmptyValue: true
      cover_url:
        description: 视频封面链接
        type: string
      video_url:
        description: 视频资源链接
        type: string
